plugins {
    id 'war'
    id 'org.hidetake.ssh' version '0.4.5'
}

remotes {
    targethost {
        host = '192.168.33.10'
        user = 'vagrant'
        identity = file("${System.properties['user.home']}/.vagrant.d/insecure_private_key")
    }
}

ssh.settings {
    logging = 'stdout'
}

task showPlatformVersion << {
    ssh.run {
        session(remotes.localhost) {
            execute('uname -a')
            execute('cat /etc/*-release || true')
        }
    }
}

ext.webappsDir = '/webapps'

task deploy(dependsOn: war) << {
    ssh.run {
        session(remotes.targethost) {
            put(war.archivePath.path, webappsDir)
            execute('sudo service tomcat restart')
        }
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.1'
}
